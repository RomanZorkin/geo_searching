# Поиск координат по фотографии
https://www.catalyzex.com/paper/arxiv:2307.05845

https://arxiv.org/abs/2307.05845

1. Составить перечень координат Барнаула
2. Загрузить панорамы Барнаула
3. Разрезать фото на более маленькие, отрезать небо и дорогу
4. Найти фото на которых площадь площадь автомобилей более 50%, изъять эти изображения
5. Подготовить структуру геозон, геоячеек
6. Сформировать структуру датасета (фото -> классы геозон)
7. Подготовить обучить модель


# Общий подход к созданию датасета

Датасет будет построен на базе панорамных снимков улиц GOOGLE MAPS

Датасет создается для определенной географической области. Первичный датасет задан для Барнаула. 
Если получиться планирую расширить до 4 городов (2 в России и 2 не в России) для формования иерархической классификации Страна -> Регион/Город -> geocell

Изначально задается географическая область - прямоугольник. Нижний левый угол - начало и верхний правый угол - конец.
Далее формируется матрица координат этого прямоугольника. Шаг между ячейками задается отдельно для долготы и широты в метрах.
Переход от градусов к метрам для первичного датасета задан в виде жестких коэффициентов. Эти коэффициенты не применимы для иных географически областей в связи со смещением широты. Для разных широт в одно градусе содержится различное кол-во км.


Первоначально шаг задан в 20 метров. Это значение подбирается в ручную. 

Для получения снимков использован сервис "streetview" https://github.com/robolyst/streetview. 
Загрузка фотографий происходит в 2 этапа. 
Первично для заданной координаты из google maps извлекается список уникальных названий панорамных снимков смежных с указанной координатой. Если задать маленький шаг между координатами будут получены списки с часто повторяющимися снимками. Если шаг будет слишком большой часть снимков могут быть упущены.
Далее по уникальному имени панорам происходит загрузка изображения.

Постобработка полученных изображений
- для расширения датасета возможно попробовать использую автоэнкодеры создать зимние, весенние, осенние снимки


# 1. Подготовка списка координат Барнаул
https://colab.research.google.com/drive/1BKJvkXlxelojyEPH_ZjippBw4HlrViX6?usp=sharing

В качестве первичного расположения был выбран Барнаул. Для этого города был задан прямоугольник в пределах
нижний левый угол
start_lat = 53.291315
start_lon = 83.590640
верхний правый угол
stop_lat = 53.399023
stop_lon = 83.805205

Шаг был выбран в 20 метров - примерно на таком расстоянии список панорамных снимков не пересекается и не пропускается

Далее простым циклом перебора координат с заданным шагом для локации Барнаул было получено 433922 координат. 

Список координат составлен. Теперь возможно для каждой координаты получить лейблы с данными о помаранных снимках.
Пример списка лейблов:
```
[Panorama(pano_id='suorKTZrkJTaGhUUlgkwIg', lat=53.32822141869757, lon=83.68271865044099, heading=280.7651977539062, pitch=90.88703918457031, roll=359.2576599121094, date='2012-07'),
 Panorama(pano_id='4sFaZfPw9WekRt7CLTFpEw', lat=53.32811947079741, lon=83.6827456451473, heading=101.4230499267578, pitch=89.6850357055664, roll=0.5733432173728943, date=None)]
```
Эта процедура занимает много времени. Google colab выдает среднюю скорость 4-5 координат в секунду, общее время выполнения может достигать 30 часов.
Для ускорения процесса выполнения одновременно было запущено несколько ноутбуков. Полученные данные объединены и очищены от дублирующих значений.

На данном этапе есть потенциал ускорения работы сервиса (распараллеливать процессы, найти иной сервис)

# 2. Загрузка панорам


По Барнаулу всего порядка 76000 панорам
По полученным уникальным лейблам необходимо загрузить панорамные снимки. Достаточно длительный процесс.
На данный момент реализован простой python скрипт 

https://colab.research.google.com/drive/1KAsBBn4Bf4ZxjmjQniubULUELyC1Rqeo?usp=sharing

Среднее время загрузки одного файла - 1-3 мин. Что делается для ускорения:
- запуск в терминале сразу нескольких скриптов одновременно
- запуск одновременно нескольких colab notebooks

Загрузка в процессе


# 3. Обрезка полученных панорамных снимков

- возможно срезать верхнюю и нижнюю часть снимка (небо, земля)
- полученное изображение разрезать на 4 части, и далее со смещением еще на 3. смещение необходимо чтобы граница была на изображении полностью

# 4. Найти фото на которых площадь площадь автомобилей более 50%, изъять эти изображения

На некоторых изображениях есть большие автомобили - автобусы, грузовики, которые могут занимать значительную площадь фото. Гипотеза такая - сегментировать данные объекты и если их площадь более допустим 50 % - такие фото удалять

# 5. Подготовить структуру геозон, геоячеек

Иерархия геозон будет иметь следующую структуру Страна -> Регион/город -> геоячейка.
Согласно https://arxiv.org/abs/2307.05845 два первых уровня оптимальнее разделить в границах административных границ.
Что касается 3 - минимального уровня иерархи, то в статье предложено использовать разбиение Вороного https://ru.wikipedia.org/wiki/Диаграмма_Вороного. Элементами множетсва, вокруг которых образуются подмножества предложено использовать координаты Достопримеча́тельностей. 
В Барнауле - немного достопримечтаельностей - и здесь нужно подумать, что брать за основу, можно:
- перекрестки - пока наиболее перспективный. В структуре загруженных лейблов есть координаты. По изменению координат вероятно будет возможно понять где будут перекрестки. Получить их координаты - это будут центры подмножеств
- торговые центры
- супермаркеты
- все-таки найти достопремичательности)))
Этот прием используется для равномерно распределения классов и признаков.


# 6. Сформировать структуру датасета

....
 
# 7. Подготовить обучить модель

....
